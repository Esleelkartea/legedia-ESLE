<?php
// auto-generated by sfPropelAdmin
// date: 2007/08/31 08:58:25
?>
<?php echo form_tag('grupos/save', array(
  'id'        => 'sf_admin_edit_form',
  'name'      => 'sf_admin_edit_form',
  'multipart' => true,
)) ?>

<?php echo object_input_hidden_tag($grupo, 'getIdGrupo') ?>
<?php include_partial('edit_actions', array('grupo' => $grupo)) ?>
<fieldset id="sf_fieldset_datos" class="">
<h2><?php echo __('Datos') ?></h2>


<div class="form-row">
  <?php echo label_for('grupo[nombre]', __($labels['grupo{nombre}']), '') ?>
  <div class="content<?php if ($sf_request->hasError('grupo{nombre}')): ?> form-error<?php endif; ?>">
  <?php if ($sf_request->hasError('grupo{nombre}')): ?>
    <?php echo form_error('grupo{nombre}', array('class' => 'form-error-msg')) ?>
  <?php endif; ?>

  <?php $value = object_input_tag($grupo, 'getNombre', array (
  'size' => 60,
  'control_name' => 'grupo[nombre]',
)); echo $value ? $value : '&nbsp;' ?>
    </div>
</div>

<div class="form-row">
  <?php echo label_for('grupo[padre]', $labels['grupo{padre}'], '') ?>
  <div class="content<?php if ($sf_request->hasError('grupo{padre}')): ?> form-error<?php endif; ?>">
  <?php if ($sf_request->hasError('grupo{padre}')): ?>
    <?php echo form_error('grupo{padre}', array('class' => 'form-error-msg')) ?>
  <?php endif; ?>
  <?php
    $padres = Grupo::arbolGrupos(true);
    $value = select_tag('grupo[padre]' , options_for_select(array('0'=>' ')+$padres , $grupo->getPadre() ) , array('control_name' => 'grupo[padre]'));
    echo $value ? $value : "&nbsp;";
  ?>
  </div>
</div>


</fieldset>

<?php if ($grupo->getIdGrupo()) : ?>
<fieldset id="sf_fieldset_datos" class="">
<h2><?php echo __('Permisos') ?></h2>
<?php
  $permisos = $grupo->obtenerTodosPermisos();
 
  $i = 0;
  $par = 0;
?>

<?php foreach($permisos as $modulo=>$acciones) : ?>
<?php $odd = fmod(++$par, 2);?>
<div class="form-row<?php echo $odd ?>">
  
  
  <div class="content">
  <?php /* echo label_for('grupo['.$modulo.']', __($modulo), '')*/?>
  <h3><?php echo __($modulo) ?></h3>
    <ul class="sf_admin_checklist">
    <?php 
      $html = "";
      $html .= "<li>";
      foreach($acciones as $accion=>$permiso)
      { 

        $html .= input_hidden_tag('modulo['.$i.']' , $modulo , array('control_name' => 'modulo['.$i.']'));
        $html .= input_hidden_tag('accion['.$i.']' , $accion , array('control_name' => 'accion['.$i.']'));
        $html .= input_hidden_tag('heredado['.$i.']' , $permiso , array('control_name' => 'heredado['.$i.']'));
        $is_checked = ($permiso==1 || $permiso==2);
        $html .= checkbox_tag('seleccionado['.$i.']' , 1 , $is_checked , array(
          'control_name' => 'seleccionado['.$i.']',
          'disabled' => ($permiso==2)
          ));
        $html .= label_for('seleccionado['.$i.']' , __($accion) , ($permiso==2) ? 'class=required' : '');
        $i++;
      }
      $html .= "</li>\n";
      echo $html;
      if (count($acciones) <= 0){
        echo "<li><i>".__('vac√≠o')."</i></li>\n";
      }
    ?>
   
    </ul>
  </div>
</div>
<?php endforeach; ?>


</fieldset>
<?php endif ; ?>
<?php include_partial('edit_actions', array('grupo' => $grupo)) ?>

</form>
<!-- No permito borrar el grupo administradores ni el grupo usuarios..-->
  <?php if ($grupo->getIsBorrable()) {?>
<ul class="sf_admin_actions">
      <li class="float-left"><?php if ($grupo->getIdGrupo()): ?>
<?php echo button_to(__('del'), 'grupos/delete?id_grupo='.$grupo->getIdGrupo(), array (
  'post' => true,
  'confirm' => __('Are you sure?'),
  'class' => 'sf_admin_action_delete',
)) ?><?php endif; ?>
</li>
  </ul>
  <?php } ?>
